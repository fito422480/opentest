description: Procesar Request
actions:

  - script: |
      var accessToken = "Bearer "+$macroArgs.accessToken

  - description: Lanzar request para extraer el pendingId
    action: org.getopentest.actions.HttpRequest
    args: 
      url: $data("mfs/data").Balance.url+"0"+$macroArgs.msisdn+"/pendingoperations"
      headers:
        Authorization: $script accessToken
        Content-Type: application/json
      verb: GET
   
  - description: Extraer Pending Id
    script: |
      var array = $output.body;
      var object = array[0];
      var pendingId = JSON.parse($json(object)).pendingId;
      $localData.pendingId = pendingId
      $log.error("PENDING ID guardado en LOCALDATA: "+ $localData.pendingId)

  - script: |
      var horaInicio = new Date();
      $log.error("HORA DE INICIO DE PROCESAR EL REQUEST: "+ horaInicio.toTimeString())

  - description: Enviar request para aceptar la transaccion
    action: org.getopentest.actions.HttpRequest
    args: 
      url: $data("mfs/data").Balance.urlPatch+$localData.pendingId
      headers:
        Authorization: $script accessToken
        Content-Type: application/json
      verb: PATCH

  - description: Vericar caso de prueba y Extraer TransactionReference
    script: |
      var object = $output.body;
      var status = JSON.parse($json(object)).status;
      if (status == "FINISH_OK"){
        $log.error("LA PRUEBA FUE EXITOSA");
        var transactionReference = JSON.parse($json(object)).transactionReference;
        $localData.transactionReference = transactionReference
        $log.error("TRANSACTION REFERENCE guardado en LOCAL DATA: "+ $localData.transactionReference)
      }else{
        $fail("LA PRUEBA NO FUE EXITOSA (VERIFICAR LOG MAS ARRIBA)");
      }
  